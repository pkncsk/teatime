{
    "sourceFile": "README.md",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1753105308270,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1753105308270,
            "name": "Commit-0",
            "content": "# `teatime` \r\nA collection of python script for TE age assignment using TEA-TIME (Transposable Element Age - Time of Integration Mapping in Evolution) approach.\r\n\r\n# Quick links\r\n- [Dependencies](#dependencies)\r\n- [Installation](#installation)\r\n- [Usage](#usage)\r\n- [Documentation](#documentation)\r\n\r\n\r\n# Dependencies\r\n- `python` 3.10\r\n- `biopython` 1.83\r\n- `compress-pickle` 2.1.0\r\n- `numpy` 1.21.5\r\n- `pandas` 1.3.5\r\n\r\n# Installation\r\n\r\nNo installation is needed, the scripts can be downloaded directly from `/pipeline` and use as is\r\n\r\n# Usage\r\n\r\n# Documentation\r\n\r\n### Quick links for docmentation\r\n- [Input preparation](#input-preparation)\r\n- [Annotation mending](#annotation-mending)\r\n- [Sequence similarity analysis](#sequence-similarity-analysis)\r\n- [TE age assignment](#te-age-assignment)\r\n- [LTR pair correction](#ltr-pair-correction)\r\n\r\n## List of scripts\r\nscripts were named according to the step in the pipeline\r\n- `01progressive_annotation_mending.py`: Annotation mending \r\n- `02e_value_calculation.py`: Sequence similarity analysis\r\n- `03age_assignment.py`: TE age assignment\r\n- `04ltr_patch.py`: LTR pair correction\r\n\r\n## Input preparation\r\n\r\nThe required inputs for the pipeline are TE coordinates and multispecies alignment files. \r\n\r\n### TE coordinates\r\n\r\nThe TE coordinates are also extracted from [the `RepeatMasker` output](https://www.repeatmasker.org/genomes/hg38/RepeatMasker-rm405-db20140131/hg38.fa.out.gz). Instead of fomatting the coordinate table as BED file containing `chromosome`, `start`, `end`, and `strand`, the full table was subsetted and extracted as is, the pipeline also requires additional fields such as `id`, `repStart`, `repEnd` and `repLeft` from the `RepeatMasker` output.\r\n\r\n### Multispecies alignment\r\n\r\nThe [updated Zoonomia dataset (primary chromosome only) were obtained from UCSC database](https://hgdownload.soe.ucsc.edu/goldenPath/hg38/cactus447way/maf/). As `MafIO.MafIndex()` from `biopython` does not support a compressed MAF file, all files were unzipped before indexing for fast data retrieval. For this framework, `.mafindex` files are required to have exactly the same name as their `.maf` counterparts as shown below.\r\n```bash\r\n\tchr1.maf\r\n\tchr1.mafindex\r\n\t...\r\n\tchrY.maf\r\n\tchrY.mafindex\r\n```\r\nThe MAF files were indexed using the python code snippet below:\r\n```python\r\n\t# build mafindex file \r\n\tfrom bio import MafIO\r\n\tmaf_file = '/path/to/maf/'\r\n\ttarget_species = 'hg38'\r\n\tmaf_id = f'{target_species}.{chrom}'\r\n\tmafindex_filedir = '.'.join(str.split(maf_file, sep='.')[:-1]) #remove .maf \r\n\tmafindex_filepath = f'{mafindex_filedir}.mafindex'\r\n\tindex_maf = MafIO.MafIndex(mafindex_filepath, maf_file, maf_id)\r\n```\r\n\r\n## TEA-TIME Pipeline\r\n\r\n### Annotation mending\r\n\r\nAssign new internal identifiers for TE entries using `01progressive_annotation_mending.py` \r\n\r\nthe script can be executed from the command line as follows:\r\n```bash\r\n\tpython3 /path/to/annotation/mending/script/01progressive_annotation_mending.py \\\r\n\t-r /path/to/repeatmasker/output.tsv \\\r\n\t-o /path/to/output/internal_id/directory \\\r\n\t-t 0.1 \\\r\n\t-s subfamily1 subfamily2\r\n\t#OR\r\n\t-S /path/to/subfamily_list.txt \r\n```\r\n\r\nAs the consensus position fields are necessary for detecting and merging fragmented TE annotations, a full or a partial RepeatMasker output table is required for this step. The required inputs for this step is a RepeatMasker output file in `.tsv` format, with headers modified to be compatible with `pandas.read_csv()`.\r\n\r\nThis step is implemented as a command-line script and accepts the following arguments:\r\n- `-r`, `--repeatmasker`: Path to the RepeatMasker output file `.tsv` format.\r\n- `-o`, `--output`: Output directory for the resulting internal ID tables.\r\n- `-s`, `--subfamily_list`: Optional list of TE subfamilies to process. If not provided, all subfamilies in the input file will be processed.\r\n- `-S`, `--subfamily_file`: Optional path to a plain-text file containing a list of TE subfamilies to process (one per line). This option is mutually exclusive with `--subfamily_list`.\r\n- `-t`, `--overlap_threshold`: A float value (default: 0.1) specifying the maximum allowed overlap between fragments for merging.\r\n\r\nTE fragments are considered mergeable only if their overlap is below the specified threshold. This reflects the assumption that small overlaps are more likely caused by annotation artifacts, whereas large overlaps are more likely to indicate distinct or nested elements. If the subfamily list is not specified, the script will automatically process all subfamilies present in the RepeatMasker table file.\r\n\r\nThe outputs of this step are tab-delimited internal ID tables named after corresponding TE subfamily: `{subfamily}.internal_id.txt`. These tables contain the row indices from the original RepeatMasker output and internal IDs for each TE fragment. The internal ID tables act as reference tables for linking information throughout the pipeline, and thus allowing consistent referencing and integration of data from other tables.\r\n\r\n### Sequence similarity analysis\r\n\r\nCompare TE alignment sequences in multispecies alignment to sequences from the reference species using `02e_value_calculation.py`.\r\n\r\nthe script can be executed from the command line as follows:\r\n```bash\r\n\tpython3 /path/to/sequence/similarity/analysis/script/02e_value_calculation.py \\\r\n\t-r /path/to/repeatmasker/output.tsv \\\r\n\t-d /path/to/internal_id/directory \\\r\n\t-x /path/to/external/data/table.tsv \\\r\n\t-m /path/to/maf/directory \\\r\n\t-o path/to/e_tables/directory \\\r\n\t-t hg38 \\\r\n\t-l 5000 \\\r\n\t-e 1e-3 \\\r\n\t-s subfamily1 subfamily2 \r\n\t#OR\r\n\t-S /path/to/subfamily_list.txt \r\n```\r\nThis step takes four inputs: the path to a directory of internal ID tables from the previous step, a `RepeatMasker` output (for TE coordinates), a directory of multispecies alignment files, and an external data table containing metadata such as `species divergence`, `genome ID`, and `aligned genome size`.\r\n\r\nThis step is implemented as a command-line script and accepts the following arguments:\r\n\r\n- `-r`, `--repeatmasker`: Path to the RepeatMasker output file (`.tsv` format).\r\n- `-d`, `--internal_id_dir`: Directory containing internal ID tables\r\n- `-m`, `--maf_dir`: Directory of multispecies alignment files (`.maf` format)\r\n- `-x`, `--external_data_table`: Path to the external data/divergence table\r\n- `-o`, `--output`: Output directory for the resulting  E-value tables.\r\n- `-s`, `--subfamily_list`: Optional list of TE subfamilies to process. If not provided, all subfamilies in the input file will be processed.\r\n- `-S`, `--subfamily_file`: Optional path to a plain-text file containing a list of TE subfamilies to process (one per line). This option is mutually exclusive with `--subfamily_list`\r\n- `-t`, `--target_species`: Target/reference genome ID (default: `hg38`)\r\n- `-l`, `--extension_length`: Length of flanking sequence around each TE (default: `5000` bp)\r\n- `-e`, `--e_value_cutoff`: E-value cutoff threshold for filtering (default: `1e-3`)\r\n\r\nThe `target_species` parameter allows users to specify reference genome ID (default: `hg38` for Zoonomia dataset). Th `extension_length` parameter control the length of the window for the surrounding regions (default:`5000` bp). The `e_value_cutoff` sets the threshold for filtering alignment based on statistical significance (`E-value`). If neither `-s` nor `-S is specified, the script will automatically process all subfamilies present in the RepeatMasker table file.\r\n\r\nThe outputs are tab-delimited E-value tables named after the corresponding TE subfamily: \\texttt{{subfamily}.e\\_table.txt}. These tables contain alignment statistics for each TE, including E-values, scores, matched bases, gap percentages, divergence times, and flanking/surrounding regions. \r\n\r\n### TE age assignment\r\n\r\nAssign TE age estimation to TE internal identifiers using `03age_assignment.py`.\r\n\r\nthe script can be executed from the command line as follows:\r\n```bash\r\n\tpython3 /path/to/sequence/similarity/analysis/script/03age_assignment.py \\\r\n\t-d /path/to/internal_id/directory \\\r\n\t-v /path/to/E-value/directory\r\n\t-r /path/to/repeatmasker/output.tsv \\\r\n\t-m /path/to/maf/directory \\\r\n\t-x /path/to/external/data/table.tsv \\\r\n\t-o path/to/age/tables/directory \\\r\n\t-t hg38 \\\r\n\t-l 5000 \\\r\n\t-e 1e-3 \\\r\n\t-a 1e-3 \\\r\n\t-s subfamily1 subfamily2 \r\n\t#OR\r\n\t-S /path/to/subfamily_list.txt \r\n```\r\nThis step requires the following inputs: a directory of `internal ID` tables, `E-value` tables, along with a `RepeatMasker` output file (for TE coordinates), multispecies alignment files, and external data table used for resolving 0 MYA cases.\r\n\r\nThis step is implemented as a command-line script and accepts the following arguments:\r\n- `-d`, `--internal_id_dir`: Directory containing internal ID tables\r\n- `-v`, `--e_table_dir`: Directory containing E-value ID tables\r\n- `-r`, `--repeatmasker`: Path to the RepeatMasker output file (`.tsv` format).\r\n- `-m`, `--maf_dir`: 0 MYA case:\tDirectory of multispecies alignment files (`.maf` format)\r\n- `-x`, `--external_data_table`: 0 MYA case - Path to the external data/divergence table\r\n- `-o`, `--output`: Output directory for the resulting TE age tables.\r\n- `-s`, `--subfamily_list`: (Optional) A list of TE subfamilies to process. If not provided, all subfamilies in the RepeatMasker output will be processed.\r\n- `-S`, `--subfamily_file`: (Optional) Path to a plain-text file containing a list of TE subfamilies to process (one per line). This option is mutually exclusive with `--subfamily_list`\r\n- `-c`, `--additional_evalue_cutoff`: Optional stringent cutoff applied to already filtered E-value tables.\r\n- `-t`, `--target_species`: 0 MYA case:\tTarget/reference genome ID (default: `hg38`)\r\n- `-l`, `--extension_length`: 0 MYA case:\tLength of flanking sequence around each TE (default: `5000` bp)\r\n- `-e`, `--e_value_cutoff`: 0 MYA case:\tE-value cutoff threshold for filtering alignment in 0 MYA cases (default: `1e-3`)\r\n\r\nAn optional E-value filter for additional stringency can be applied using `additional_evalue_cutoff`. If neither `-s` nor `-S` is provided, the script will process all available TE subfamilies in the RepeatMasker table.\r\n\r\nThe outputs of this step are tab-delimited TE age tables named after the corresponding TE subfamily: `{subfamily}.teatime.txt`, containing internal IDs and their assigned TE ages. For 0 MYA cases, the script also produces additional tables summarizing statistics from surrounding regions: `subfamily.insertion.txt` and `subfamily.segmental.txt` based on categorization from the script.\r\n\r\n### LTR pair correction\r\n\r\nReadjust LTR age estimates of the intact LTR pairs using `04ltr_patch.py`\r\n\r\nthe script can be executed like any standard Python script:\r\n```bash\r\n\tpython3 /path/to/sequence/similarity/analysis/script/04ltr\\_patch.py \\\r\n\t-d /path/to/internal_id/directory \\\r\n\t-a /path/to/age/table/directory \\\r\n\t-r /path/to/repeatmasker/output.tsv \\\r\n\t-o /path/to/corrected/age/tables/directory \\\r\n\t-m greedy \\\r\n\t-s subfamily1 subfamily2 \r\n\t#OR\r\n\t- S /path/to/subfamily_list.txt \r\n```\r\nThis post-assignment step is specific to LTR TEs. The inputs are path to a directory of `TE age` tables, `internal ID` tables, and a `RepeatMasker` output file. \r\n\r\nThis step is implemented as a command-line script and accepts the following arguments:\r\n- `-d`, `--internal_id_dir`: Path to the directory containing internal ID tables.\r\n- `-a`, `--age_table_dir`: Path to the directory containing the initial TE age tables.\r\n- `-r`, `--repeatmasker`: Path to the RepeatMasker output file (in `.tsv` format).\r\n- `-o`, `--output`: Output directory for the corrected TE age tables.\r\n- `-s`, `--subfamily_list`: (Optional) A list of TE subfamilies to process. If not provided, all subfamilies in the RepeatMasker output will be processed.\r\n- `-S`, `--subfamily_file`: (Optional) Path to a plain-text file containing a list of TE subfamilies to process (one per line). This option is mutually exclusive with `--subfamily_list`\r\n- `-m`, `--correction_mode`: (Optional) Strategy for age correction. Available options:\r\n\t- `strict` (default): Uses only the age of the LTR.\r\n\t- `ltr-int`: If a matching internal element (e.g., `LTR-int`) exists, its TE age is included in the \tcorrection.\r\n\t- `greedy`: Attempts to identify any likely matching internal fragment based on naming similarity, even across subfamilies.\r\n\r\nAs with previous scripts, this script is designed to iterate through all LTR subfamilies. However, users can specify a custom list of TE subfamilies either by passing names directly with `-s` or providing a file with `-S`. If neither is provided, all subfamilies present in the RepeatMasker output will be processed.\r\n\r\nThe outputs of this step are tab-delimited corrected TE age table named after the corresponding TE subfamily: `subfamily.ltr_fix.txt`, containing internal IDs and their corrected TE ages.\r\n\r\n\r\n\r\n## License\r\nThis repository is licensed under the MIT License. "
        }
    ]
}